<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸ”® å¡”ç¾…å åœ & å…«å­—å‘½ç›¤</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&family=Noto+Serif+TC:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #16161f;
            --bg-tertiary: #1e1e2a;
            --bg-card: linear-gradient(145deg, #1a1a25, #12121a);
            --text-primary: #f0e6d3;
            --text-secondary: #a09080;
            --text-gold: #d4af37;
            --accent-purple: #9b59b6;
            --accent-blue: #3498db;
            --accent-gold: #f39c12;
            --accent-red: #e74c3c;
            --accent-green: #27ae60;
            --border-color: #2a2a3a;
            --glow-purple: rgba(155, 89, 182, 0.3);
            --glow-gold: rgba(212, 175, 55, 0.3);
            --safe-top: env(safe-area-inset-top, 47px);
            --safe-bottom: env(safe-area-inset-bottom, 34px);
            /* å†·å…‰ç§‘æŠ€è‰² */
            --neon-cyan: #00f5ff;
            --neon-purple: #bf00ff;
            --neon-blue: #0080ff;
        }
        
        /* ============================================
           ğŸŒ€ å†·å…‰ç§‘æŠ€é–‹æ©Ÿå‹•ç•«
           ============================================ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0a1a 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }
        
        .splash-screen.fade-out {
            opacity: 0;
            visibility: hidden;
        }
        
        /* ä¸»è¦å®¹å™¨ */
        .splash-container {
            position: relative;
            width: 280px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ä¸­å¿ƒã€Œå¦ã€å­— */
        .splash-text {
            font-family: 'Noto Serif TC', serif;
            font-size: 100px;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-purple) 50%, var(--neon-cyan) 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textGlow 2s ease-in-out infinite, textShine 3s linear infinite;
            filter: drop-shadow(0 0 20px var(--neon-cyan)) drop-shadow(0 0 40px var(--neon-purple));
            z-index: 10;
        }
        
        @keyframes textGlow {
            0%, 100% { filter: drop-shadow(0 0 20px var(--neon-cyan)) drop-shadow(0 0 40px var(--neon-purple)); }
            50% { filter: drop-shadow(0 0 40px var(--neon-cyan)) drop-shadow(0 0 60px var(--neon-purple)) drop-shadow(0 0 80px var(--neon-blue)); }
        }
        
        @keyframes textShine {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }
        
        /* å¤–åœˆæ—‹è½‰ç’° 1 */
        .ring-1 {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top-color: var(--neon-cyan);
            border-right-color: var(--neon-cyan);
            border-radius: 50%;
            animation: spin 2s linear infinite;
            box-shadow: 0 0 20px var(--neon-cyan), inset 0 0 20px rgba(0, 245, 255, 0.1);
        }
        
        /* å¤–åœˆæ—‹è½‰ç’° 2 */
        .ring-2 {
            position: absolute;
            width: 85%;
            height: 85%;
            border: 2px solid transparent;
            border-bottom-color: var(--neon-purple);
            border-left-color: var(--neon-purple);
            border-radius: 50%;
            animation: spin-reverse 1.5s linear infinite;
            box-shadow: 0 0 15px var(--neon-purple), inset 0 0 15px rgba(191, 0, 255, 0.1);
        }
        
        /* å¤–åœˆæ—‹è½‰ç’° 3 */
        .ring-3 {
            position: absolute;
            width: 70%;
            height: 70%;
            border: 2px dashed var(--neon-blue);
            border-radius: 50%;
            animation: spin 3s linear infinite;
            opacity: 0.6;
        }
        
        /* å…«å¦ç¬¦è™Ÿç’° */
        .bagua-ring {
            position: absolute;
            width: 110%;
            height: 110%;
            animation: spin-reverse 10s linear infinite;
        }
        
        .bagua-symbol {
            position: absolute;
            font-size: 20px;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
            animation: symbolPulse 2s ease-in-out infinite;
        }
        
        .bagua-symbol:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); animation-delay: 0s; }
        .bagua-symbol:nth-child(2) { top: 15%; right: 15%; animation-delay: 0.25s; }
        .bagua-symbol:nth-child(3) { top: 50%; right: 0; transform: translateY(-50%); animation-delay: 0.5s; }
        .bagua-symbol:nth-child(4) { bottom: 15%; right: 15%; animation-delay: 0.75s; }
        .bagua-symbol:nth-child(5) { bottom: 0; left: 50%; transform: translateX(-50%); animation-delay: 1s; }
        .bagua-symbol:nth-child(6) { bottom: 15%; left: 15%; animation-delay: 1.25s; }
        .bagua-symbol:nth-child(7) { top: 50%; left: 0; transform: translateY(-50%); animation-delay: 1.5s; }
        .bagua-symbol:nth-child(8) { top: 15%; left: 15%; animation-delay: 1.75s; }
        
        @keyframes symbolPulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes spin-reverse {
            0% { transform: rotate(360deg); }
            100% { transform: rotate(0deg); }
        }
        
        /* ç²’å­æ•ˆæœ */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--neon-cyan);
            border-radius: 50%;
            animation: particleFloat 3s ease-in-out infinite;
            box-shadow: 0 0 10px var(--neon-cyan);
        }
        
        .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 20%; animation-delay: 0.5s; }
        .particle:nth-child(3) { left: 30%; animation-delay: 1s; }
        .particle:nth-child(4) { left: 40%; animation-delay: 1.5s; }
        .particle:nth-child(5) { left: 50%; animation-delay: 0.3s; }
        .particle:nth-child(6) { left: 60%; animation-delay: 0.8s; }
        .particle:nth-child(7) { left: 70%; animation-delay: 1.3s; }
        .particle:nth-child(8) { left: 80%; animation-delay: 0.6s; }
        .particle:nth-child(9) { left: 90%; animation-delay: 1.1s; }
        
        @keyframes particleFloat {
            0% { bottom: -10px; opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { bottom: 100%; opacity: 0; }
        }
        
        /* è¼‰å…¥æ–‡å­— */
        .splash-loading {
            margin-top: 60px;
            text-align: center;
        }
        
        .splash-title {
            font-family: 'Noto Serif TC', serif;
            font-size: 24px;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px var(--neon-cyan);
            margin-bottom: 16px;
            animation: titlePulse 2s ease-in-out infinite;
        }
        
        @keyframes titlePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .splash-subtitle {
            font-size: 14px;
            color: #666;
            letter-spacing: 4px;
        }
        
        /* é€²åº¦æ¢ */
        .progress-bar {
            width: 200px;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 24px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple), var(--neon-cyan));
            background-size: 200% 100%;
            border-radius: 2px;
            animation: progressAnim 2s ease-in-out forwards, progressShine 1s linear infinite;
        }
        
        @keyframes progressAnim {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        @keyframes progressShine {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(ellipse at top, rgba(155, 89, 182, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(212, 175, 55, 0.05) 0%, transparent 50%);
        }
        
        /* iPhone å®¹å™¨ */
        .app-container {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            position: relative;
        }
        
        /* ç‹€æ…‹åˆ— */
        .status-bar {
            height: calc(var(--safe-top) + 0px);
            min-height: 47px;
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 24px 8px;
            font-size: 14px;
            font-weight: 600;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 430px;
            margin: 0 auto;
            z-index: 100;
        }
        
        .dynamic-island {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 126px;
            height: 37px;
            background: #000;
            border-radius: 20px;
        }
        
        /* ä¸»å…§å®¹ */
        .main-content {
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 80px);
        }
        
        /* æ¨™é¡Œå€ */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header-icon {
            font-size: 60px;
            margin-bottom: 12px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .header h1 {
            font-family: 'Noto Serif TC', serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-gold) 0%, #fff 50%, var(--text-gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* åŠŸèƒ½é¸æ“‡ */
        .feature-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .feature-tab {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .feature-tab.active {
            background: linear-gradient(145deg, rgba(155, 89, 182, 0.2), rgba(212, 175, 55, 0.1));
            border-color: var(--accent-purple);
            box-shadow: 0 0 20px var(--glow-purple);
        }
        
        .feature-tab-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .feature-tab-title {
            font-size: 14px;
            font-weight: 600;
        }
        
        /* å…§å®¹å€å¡Š */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¡”ç¾…ç‰Œå€ */
        .tarot-section {
            text-align: center;
        }
        
        .tarot-spread {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            perspective: 1000px;
        }
        
        .tarot-card {
            width: 90px;
            height: 150px;
            background: linear-gradient(145deg, #2a1f4e, #1a1030);
            border: 2px solid var(--text-gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        
        .tarot-card:hover {
            transform: translateY(-10px) rotateY(10deg);
            box-shadow: 0 15px 40px rgba(155, 89, 182, 0.3);
        }
        
        .tarot-card.flipped {
            transform: rotateY(180deg);
        }
        
        .tarot-card .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: linear-gradient(145deg, #2a1f4e, #1a1030);
        }
        
        .tarot-card .card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: linear-gradient(145deg, #f5f0e1, #e8dcc8);
            color: #2d2d2d;
            padding: 8px;
        }
        
        .tarot-card .card-front .card-image {
            font-size: 50px;
            margin-bottom: 4px;
        }
        
        .tarot-card .card-front .card-name {
            font-size: 9px;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }
        
        .draw-btn {
            background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px var(--glow-purple);
        }
        
        .draw-btn:active {
            transform: scale(0.95);
        }
        
        .draw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* çµæœå¡ç‰‡ */
        .result-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            margin-top: 24px;
            display: none;
        }
        
        .result-card.show {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-card-image {
            width: 80px;
            height: 120px;
            background: linear-gradient(145deg, #f5f0e1, #e8dcc8);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #2d2d2d;
            flex-shrink: 0;
        }
        
        .result-card-image .name {
            font-size: 10px;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .result-info h3 {
            font-family: 'Noto Serif TC', serif;
            font-size: 20px;
            color: var(--text-gold);
            margin-bottom: 4px;
        }
        
        .result-info .en-name {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .result-info .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .keyword {
            background: rgba(155, 89, 182, 0.2);
            color: var(--accent-purple);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .result-content {
            margin-bottom: 20px;
        }
        
        .result-content h4 {
            font-size: 14px;
            color: var(--text-gold);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .result-content p {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.7;
        }
        
        .fortune-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .fortune-item {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }
        
        .fortune-item .icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .fortune-item .label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .fortune-item .score {
            font-size: 18px;
            font-weight: 700;
        }
        
        .fortune-item .score.high { color: var(--accent-green); }
        .fortune-item .score.mid { color: var(--accent-gold); }
        .fortune-item .score.low { color: var(--accent-red); }
        
        /* å…«å­—å€ */
        .bazi-form {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .form-group input,
        .form-group select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .analyze-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent-gold), #e67e22);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
        }
        
        /* å…«å­—çµæœ */
        .bazi-result {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            display: none;
        }
        
        .bazi-result.show {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        .bazi-pillars {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 20px 0;
        }
        
        .bazi-pillar {
            text-align: center;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 12px 8px;
        }
        
        .pillar-title {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .pillar-char {
            font-family: 'Noto Serif TC', serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .pillar-char.heaven {
            color: var(--accent-red);
        }
        
        .pillar-char.earth {
            color: var(--accent-green);
        }
        
        .pillar-element {
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .element-analysis {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .element-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .element-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .element-name {
            width: 40px;
            font-size: 14px;
        }
        
        .element-bar-bg {
            flex: 1;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .element-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .element-bar-fill.wood { background: linear-gradient(90deg, #27ae60, #2ecc71); }
        .element-bar-fill.fire { background: linear-gradient(90deg, #e74c3c, #ff6b6b); }
        .element-bar-fill.earth { background: linear-gradient(90deg, #f39c12, #f1c40f); }
        .element-bar-fill.metal { background: linear-gradient(90deg, #bdc3c7, #ecf0f1); }
        .element-bar-fill.water { background: linear-gradient(90deg, #3498db, #74b9ff); }
        
        .element-count {
            width: 30px;
            text-align: right;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* LINE ç™¼é€æŒ‰éˆ• */
        .line-send-btn {
            width: 100%;
            background: linear-gradient(135deg, #00b900, #00c300);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .line-send-btn:disabled {
            opacity: 0.5;
        }
        
        /* è¨­å®šæŒ‰éˆ• */
        .settings-btn {
            position: fixed;
            top: calc(var(--safe-top) + 10px);
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 101;
        }
        
        /* è¨­å®šé¢æ¿ */
        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 200;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .settings-panel.active {
            transform: translateX(0);
        }
        
        .settings-header {
            padding: calc(var(--safe-top) + 20px) 20px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }
        
        .settings-header h2 {
            font-size: 20px;
        }
        
        .settings-close {
            background: none;
            border: none;
            color: var(--accent-purple);
            font-size: 16px;
            cursor: pointer;
        }
        
        .settings-content {
            padding: 20px;
        }
        
        .settings-section {
            margin-bottom: 24px;
        }
        
        .settings-section-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .settings-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
        }
        
        .settings-item {
            margin-bottom: 16px;
        }
        
        .settings-item:last-child {
            margin-bottom: 0;
        }
        
        .settings-item label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .settings-item input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .settings-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
        }
        
        .settings-hint a {
            color: var(--accent-purple);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 300;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 430px;
            margin: 0 auto;
            background: rgba(22, 22, 31, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 12px 20px calc(12px + var(--safe-bottom));
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--border-color);
        }
        
        .nav-item {
            text-align: center;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        
        .nav-item.active {
            opacity: 1;
        }
        
        .nav-item .icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-item .label {
            font-size: 11px;
        }
    </style>
</head>
<body>
    <!-- ============================================
         ğŸŒ€ å†·å…‰ç§‘æŠ€é–‹æ©Ÿå‹•ç•«
         ============================================ -->
    <div class="splash-screen" id="splashScreen">
        <!-- ç²’å­èƒŒæ™¯ -->
        <div class="particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
        
        <!-- ä¸»å®¹å™¨ -->
        <div class="splash-container">
            <!-- å…«å¦ç¬¦è™Ÿç’° -->
            <div class="bagua-ring">
                <span class="bagua-symbol">â˜°</span>
                <span class="bagua-symbol">â˜±</span>
                <span class="bagua-symbol">â˜²</span>
                <span class="bagua-symbol">â˜³</span>
                <span class="bagua-symbol">â˜´</span>
                <span class="bagua-symbol">â˜µ</span>
                <span class="bagua-symbol">â˜¶</span>
                <span class="bagua-symbol">â˜·</span>
            </div>
            
            <!-- æ—‹è½‰ç’° -->
            <div class="ring-1"></div>
            <div class="ring-2"></div>
            <div class="ring-3"></div>
            
            <!-- ä¸­å¿ƒã€Œå¦ã€å­— -->
            <div class="splash-text">å¦</div>
        </div>
        
        <!-- è¼‰å…¥æ–‡å­— -->
        <div class="splash-loading">
            <div class="splash-title">å‘½ç†å åœ</div>
            <div class="splash-subtitle">LOADING...</div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- ç‹€æ…‹åˆ— -->
        <div class="status-bar">
            <div class="dynamic-island"></div>
            <span id="statusTime">9:41</span>
            <span>ğŸ”®</span>
        </div>
        
        <!-- è¨­å®šæŒ‰éˆ• -->
        <button class="settings-btn" onclick="showSettings()">âš™ï¸</button>
        
        <!-- ä¸»å…§å®¹ -->
        <div class="main-content">
            <!-- æ¨™é¡Œ -->
            <div class="header">
                <div class="header-icon">ğŸ”®</div>
                <h1>å‘½ç†å åœ</h1>
                <p>å¡”ç¾…å åœ Â· å…«å­—å‘½ç›¤ Â· LINE æ¨é€</p>
            </div>
            
            <!-- åŠŸèƒ½é¸æ“‡ -->
            <div class="feature-tabs">
                <div class="feature-tab active" onclick="switchTab('tarot')">
                    <div class="feature-tab-icon">ğŸƒ</div>
                    <div class="feature-tab-title">å¡”ç¾…å åœ</div>
                </div>
                <div class="feature-tab" onclick="switchTab('bazi')">
                    <div class="feature-tab-icon">ğŸ“…</div>
                    <div class="feature-tab-title">å…«å­—å‘½ç›¤</div>
                </div>
            </div>
            
            <!-- å¡”ç¾…å åœå€ -->
            <div class="content-section active" id="tarot-section">
                <div class="tarot-section">
                    <p style="color: var(--text-secondary); margin-bottom: 16px;">é¸æ“‡å åœé¡å‹ï¼Œè®“å¡”ç¾…ç‚ºä½ æŒ‡å¼•æ–¹å‘</p>
                    
                    <select id="tarotType" style="width: 100%; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 14px; color: var(--text-primary); font-size: 15px; margin-bottom: 20px;">
                        <option value="daily">ğŸŒ… æ¯æ—¥é‹å‹¢</option>
                        <option value="love">ğŸ’• æ„›æƒ…é‹å‹¢</option>
                        <option value="career">ğŸ’¼ äº‹æ¥­é‹å‹¢</option>
                        <option value="wealth">ğŸ’° è²¡é‹åˆ†æ</option>
                        <option value="yes-no">â“ æ˜¯éé¡Œå åœ</option>
                    </select>
                    
                    <div class="tarot-spread">
                        <div class="tarot-card" id="card1" onclick="flipCard(1)">
                            <div class="card-back">ğŸŒ™</div>
                            <div class="card-front">
                                <span class="card-image">?</span>
                                <span class="card-name">ç¿»ç‰Œæ­æ›‰</span>
                            </div>
                        </div>
                        <div class="tarot-card" id="card2" onclick="flipCard(2)">
                            <div class="card-back">â­</div>
                            <div class="card-front">
                                <span class="card-image">?</span>
                                <span class="card-name">ç¿»ç‰Œæ­æ›‰</span>
                            </div>
                        </div>
                        <div class="tarot-card" id="card3" onclick="flipCard(3)">
                            <div class="card-back">â˜€ï¸</div>
                            <div class="card-front">
                                <span class="card-image">?</span>
                                <span class="card-name">ç¿»ç‰Œæ­æ›‰</span>
                            </div>
                        </div>
                    </div>
                    
                    <p class="flip-hint" id="flipHint" style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px; display: none;">ğŸ‘† é»æ“Šå¡ç‰Œç¿»ç‰Œ</p>
                    
                    <!-- ç¿»ç‰Œæ¨¡å¼é¸æ“‡ -->
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 16px;">
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 14px; color: var(--text-secondary);">
                            <input type="radio" name="flipMode" value="auto" checked style="accent-color: var(--accent-purple);"> 
                            ğŸ¬ è‡ªå‹•ç¿»ç‰Œ
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 14px; color: var(--text-secondary);">
                            <input type="radio" name="flipMode" value="manual" style="accent-color: var(--accent-purple);"> 
                            ğŸ‘† æ‰‹å‹•ç¿»ç‰Œ
                        </label>
                    </div>
                    
                    <button class="draw-btn" onclick="drawTarot()">ğŸ”® é–‹å§‹å åœ</button>
                    
                    <!-- å¡”ç¾…çµæœ -->
                    <div class="result-card" id="tarotResult">
                        <div class="result-header">
                            <div class="result-card-image" id="resultCardImage">
                                <span>ğŸƒ</span>
                                <span class="name">ç‰Œå</span>
                            </div>
                            <div class="result-info">
                                <h3 id="resultCardName">æ„šè€…</h3>
                                <div class="en-name" id="resultCardEnName">The Fool</div>
                                <div class="keywords" id="resultKeywords">
                                    <span class="keyword">æ–°é–‹å§‹</span>
                                    <span class="keyword">å†’éšª</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="fortune-scores" id="fortuneScores">
                            <div class="fortune-item">
                                <div class="icon">â­</div>
                                <div class="label">æ•´é«”é‹å‹¢</div>
                                <div class="score high" id="overallScore">85</div>
                            </div>
                            <div class="fortune-item">
                                <div class="icon">ğŸ’•</div>
                                <div class="label">æ„›æƒ…é‹</div>
                                <div class="score mid" id="loveScore">70</div>
                            </div>
                            <div class="fortune-item">
                                <div class="icon">ğŸ’¼</div>
                                <div class="label">äº‹æ¥­é‹</div>
                                <div class="score high" id="careerScore">80</div>
                            </div>
                            <div class="fortune-item">
                                <div class="icon">ğŸ’°</div>
                                <div class="label">è²¡é‹</div>
                                <div class="score mid" id="wealthScore">65</div>
                            </div>
                        </div>
                        
                        <div class="result-content">
                            <h4>ğŸ“– ç‰Œç¾©è§£è®€</h4>
                            <p id="resultMeaning">ç‰Œç¾©å…§å®¹...</p>
                        </div>
                        
                        <div class="result-content">
                            <h4>ğŸ’¡ ä»Šæ—¥å»ºè­°</h4>
                            <p id="resultAdvice">å»ºè­°å…§å®¹...</p>
                        </div>
                        
                        <button class="line-send-btn" onclick="sendTarotToLine()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M12 2C6.48 2 2 5.82 2 10.5c0 2.55 1.25 4.83 3.24 6.36-.12.97-.63 3.61-.73 4.19 0 0-.02.17.09.24.1.06.24.02.24.02.32-.04 3.78-2.47 4.36-2.89.93.14 1.87.21 2.8.21 5.52 0 10-3.82 10-8.5S17.52 2 12 2z"/>
                            </svg>
                            ç™¼é€åˆ° LINE
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å…«å­—å‘½ç›¤å€ -->
            <div class="content-section" id="bazi-section">
                <div class="bazi-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>å‡ºç”Ÿå¹´</label>
                            <input type="number" id="birthYear" placeholder="å¦‚ï¼š1990" min="1900" max="2030">
                        </div>
                        <div class="form-group">
                            <label>å‡ºç”Ÿæœˆ</label>
                            <select id="birthMonth">
                                <option value="">é¸æ“‡æœˆä»½</option>
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å‡ºç”Ÿæ—¥</label>
                            <input type="number" id="birthDay" placeholder="å¦‚ï¼š15" min="1" max="31">
                        </div>
                        <div class="form-group">
                            <label>å‡ºç”Ÿæ™‚è¾°</label>
                            <select id="birthHour">
                                <option value="">é¸æ“‡æ™‚è¾°</option>
                                <option value="0">å­æ™‚ (23:00-01:00)</option>
                                <option value="1">ä¸‘æ™‚ (01:00-03:00)</option>
                                <option value="2">å¯…æ™‚ (03:00-05:00)</option>
                                <option value="3">å¯æ™‚ (05:00-07:00)</option>
                                <option value="4">è¾°æ™‚ (07:00-09:00)</option>
                                <option value="5">å·³æ™‚ (09:00-11:00)</option>
                                <option value="6">åˆæ™‚ (11:00-13:00)</option>
                                <option value="7">æœªæ™‚ (13:00-15:00)</option>
                                <option value="8">ç”³æ™‚ (15:00-17:00)</option>
                                <option value="9">é…‰æ™‚ (17:00-19:00)</option>
                                <option value="10">æˆŒæ™‚ (19:00-21:00)</option>
                                <option value="11">äº¥æ™‚ (21:00-23:00)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æ€§åˆ¥</label>
                        <select id="gender">
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                    </div>
                    <button class="analyze-btn" onclick="analyzeBazi()">ğŸ” åˆ†æå‘½ç›¤</button>
                </div>
                
                <!-- å…«å­—çµæœ -->
                <div class="bazi-result" id="baziResult">
                    <h3 style="text-align: center; color: var(--text-gold); margin-bottom: 16px; font-family: 'Noto Serif TC', serif;">ğŸ“œ å…«å­—å‘½ç›¤</h3>
                    
                    <div class="bazi-pillars" id="baziPillars">
                        <div class="bazi-pillar">
                            <div class="pillar-title">å¹´æŸ±</div>
                            <div class="pillar-char heaven" id="yearHeaven">ç”²</div>
                            <div class="pillar-char earth" id="yearEarth">å­</div>
                            <div class="pillar-element" id="yearElement">æœ¨/æ°´</div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-title">æœˆæŸ±</div>
                            <div class="pillar-char heaven" id="monthHeaven">ä¹™</div>
                            <div class="pillar-char earth" id="monthEarth">ä¸‘</div>
                            <div class="pillar-element" id="monthElement">æœ¨/åœŸ</div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-title">æ—¥æŸ±</div>
                            <div class="pillar-char heaven" id="dayHeaven">ä¸™</div>
                            <div class="pillar-char earth" id="dayEarth">å¯…</div>
                            <div class="pillar-element" id="dayElement">ç«/æœ¨</div>
                        </div>
                        <div class="bazi-pillar">
                            <div class="pillar-title">æ™‚æŸ±</div>
                            <div class="pillar-char heaven" id="hourHeaven">ä¸</div>
                            <div class="pillar-char earth" id="hourEarth">å¯</div>
                            <div class="pillar-element" id="hourElement">ç«/æœ¨</div>
                        </div>
                    </div>
                    
                    <div class="element-analysis">
                        <h4 style="margin-bottom: 12px; font-size: 14px;">ğŸ”¥ äº”è¡Œåˆ†æ</h4>
                        <div class="element-bars">
                            <div class="element-bar">
                                <span class="element-name">ğŸŒ³ æœ¨</span>
                                <div class="element-bar-bg">
                                    <div class="element-bar-fill wood" id="woodBar" style="width: 30%;"></div>
                                </div>
                                <span class="element-count" id="woodCount">2</span>
                            </div>
                            <div class="element-bar">
                                <span class="element-name">ğŸ”¥ ç«</span>
                                <div class="element-bar-bg">
                                    <div class="element-bar-fill fire" id="fireBar" style="width: 20%;"></div>
                                </div>
                                <span class="element-count" id="fireCount">1</span>
                            </div>
                            <div class="element-bar">
                                <span class="element-name">â›°ï¸ åœŸ</span>
                                <div class="element-bar-bg">
                                    <div class="element-bar-fill earth" id="earthBar" style="width: 25%;"></div>
                                </div>
                                <span class="element-count" id="earthCount">2</span>
                            </div>
                            <div class="element-bar">
                                <span class="element-name">ğŸª™ é‡‘</span>
                                <div class="element-bar-bg">
                                    <div class="element-bar-fill metal" id="metalBar" style="width: 15%;"></div>
                                </div>
                                <span class="element-count" id="metalCount">1</span>
                            </div>
                            <div class="element-bar">
                                <span class="element-name">ğŸ’§ æ°´</span>
                                <div class="element-bar-bg">
                                    <div class="element-bar-fill water" id="waterBar" style="width: 10%;"></div>
                                </div>
                                <span class="element-count" id="waterCount">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-content">
                        <h4>ğŸ‘¤ æ—¥ä¸»åˆ†æ</h4>
                        <p id="dayMasterAnalysis">æ—¥ä¸»åˆ†æå…§å®¹...</p>
                    </div>
                    
                    <div class="result-content">
                        <h4>ğŸ’« å‘½æ ¼ç‰¹é»</h4>
                        <p id="destinyAnalysis">å‘½æ ¼åˆ†æå…§å®¹...</p>
                    </div>
                    
                    <div class="result-content">
                        <h4>ğŸ¯ é–‹é‹å»ºè­°</h4>
                        <p id="luckyAdvice">é–‹é‹å»ºè­°å…§å®¹...</p>
                    </div>
                    
                    <button class="line-send-btn" onclick="sendBaziToLine()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C6.48 2 2 5.82 2 10.5c0 2.55 1.25 4.83 3.24 6.36-.12.97-.63 3.61-.73 4.19 0 0-.02.17.09.24.1.06.24.02.24.02.32-.04 3.78-2.47 4.36-2.89.93.14 1.87.21 2.8.21 5.52 0 10-3.82 10-8.5S17.52 2 12 2z"/>
                        </svg>
                        ç™¼é€åˆ° LINE
                    </button>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨å°èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('tarot')">
                <div class="icon">ğŸƒ</div>
                <div class="label">å¡”ç¾…</div>
            </div>
            <div class="nav-item" onclick="switchTab('bazi')">
                <div class="icon">ğŸ“…</div>
                <div class="label">å…«å­—</div>
            </div>
            <div class="nav-item" onclick="showHistory()">
                <div class="icon">ğŸ“œ</div>
                <div class="label">æ­·å²</div>
            </div>
        </div>
    </div>
    
    <!-- è¨­å®šé¢æ¿ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>âš™ï¸ è¨­å®š</h2>
            <button class="settings-close" onclick="hideSettings()">å®Œæˆ</button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">LINE é€šçŸ¥è¨­å®š</div>
                <div class="settings-card">
                    <div class="settings-item">
                        <label>GAS Web App URL</label>
                        <input type="text" id="gasUrl" placeholder="https://script.google.com/...">
                        <div class="settings-hint">éƒ¨ç½² GAS å¾Œå–å¾—çš„ç¶²å€</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ============================================
        // å¡”ç¾…ç‰Œè³‡æ–™åº«ï¼ˆå¤§é˜¿çˆ¾å…‹é‚£ 22 å¼µï¼‰
        // ============================================
        const tarotDeck = [
            { id: 0, name: 'æ„šè€…', enName: 'The Fool', icon: 'ğŸƒ', keywords: ['æ–°é–‹å§‹', 'å†’éšª', 'ç´”çœŸ', 'è‡ªç”±'],
              meaning: 'æ„šè€…ä»£è¡¨è‘—æ–°çš„é–‹å§‹å’Œç„¡é™çš„å¯èƒ½æ€§ã€‚å®ƒè±¡å¾µè‘—å‹‡æ–¼å†’éšªã€ä¿æŒç´”çœŸçš„å¿ƒæ…‹ï¼Œä»¥åŠå°æœªçŸ¥ä¸–ç•Œçš„å¥½å¥‡èˆ‡æ¢ç´¢ã€‚',
              advice: 'ä»Šå¤©é©åˆå˜—è©¦æ–°äº‹ç‰©ï¼Œä¿æŒé–‹æ”¾çš„å¿ƒæ…‹ã€‚ä¸è¦è¢«æ—¢æœ‰çš„æ¡†æ¶é™åˆ¶ï¼Œç›¸ä¿¡è‡ªå·±çš„ç›´è¦ºã€‚' },
            { id: 1, name: 'é­”è¡“å¸«', enName: 'The Magician', icon: 'ğŸ©', keywords: ['å‰µé€ åŠ›', 'æ„å¿—åŠ›', 'æŠ€èƒ½', 'è¡Œå‹•'],
              meaning: 'é­”è¡“å¸«ä»£è¡¨è‘—å¼·å¤§çš„å‰µé€ åŠ›å’Œè¡Œå‹•åŠ›ã€‚ä½ æ“æœ‰å°‡æƒ³æ³•åŒ–ç‚ºç¾å¯¦çš„èƒ½åŠ›ï¼Œæ‰€æœ‰è³‡æºéƒ½å·²é½Šå‚™ã€‚',
              advice: 'ç¾åœ¨æ˜¯å±•ç¾æ‰èƒ½çš„å¥½æ™‚æ©Ÿï¼Œå–„ç”¨ä½ çš„æŠ€èƒ½å’Œè³‡æºï¼Œä¸»å‹•å‡ºæ“Šæœƒæœ‰å¥½çµæœã€‚' },
            { id: 2, name: 'å¥³ç¥­å¸', enName: 'The High Priestess', icon: 'ğŸŒ™', keywords: ['ç›´è¦º', 'ç¥ç§˜', 'æ™ºæ…§', 'æ½›æ„è­˜'],
              meaning: 'å¥³ç¥­å¸ä»£è¡¨è‘—æ·±å±¤çš„ç›´è¦ºå’Œå…§åœ¨æ™ºæ…§ã€‚å¥¹æé†’ä½ å‚¾è½å…§å¿ƒçš„è²éŸ³ï¼Œé—œæ³¨å¤¢å¢ƒå’Œæ½›æ„è­˜çš„è¨Šæ¯ã€‚',
              advice: 'ä»Šå¤©ä¸å®œåŒ†å¿™åšæ±ºå®šï¼Œéœä¸‹å¿ƒä¾†å‚¾è½å…§å¿ƒçš„æŒ‡å¼•ï¼Œç­”æ¡ˆå°±åœ¨ä½ å¿ƒä¸­ã€‚' },
            { id: 3, name: 'å¥³çš‡', enName: 'The Empress', icon: 'ğŸ‘‘', keywords: ['è±ç››', 'æ¯æ€§', 'å‰µé€ ', 'ç¾éº—'],
              meaning: 'å¥³çš‡ä»£è¡¨è‘—è±ç››èˆ‡å‰µé€ åŠ›ã€‚å¥¹è±¡å¾µè‘—ç”Ÿå‘½çš„æ»‹é¤Šã€ç‰©è³ªçš„å¯Œè¶³ï¼Œä»¥åŠè—è¡“ç¾æ„Ÿçš„å±•ç¾ã€‚',
              advice: 'äº«å—ç”Ÿæ´»ä¸­çš„ç¾å¥½äº‹ç‰©ï¼Œé—œæ„›èº«é‚Šçš„äººã€‚å‰µæ„é …ç›®æœƒæœ‰å¥½çš„é€²å±•ã€‚' },
            { id: 4, name: 'çš‡å¸', enName: 'The Emperor', icon: 'ğŸ°', keywords: ['æ¬Šå¨', 'ç©©å®š', 'é ˜å°', 'ä¿è­·'],
              meaning: 'çš‡å¸ä»£è¡¨è‘—æ¬Šå¨å’Œç©©å®šçš„åŠ›é‡ã€‚ä»–è±¡å¾µè‘—ç†æ€§æ€ç¶­ã€ç´€å¾‹å’Œå»ºç«‹ç§©åºçš„èƒ½åŠ›ã€‚',
              advice: 'å±•ç¾ä½ çš„é ˜å°æ‰èƒ½ï¼Œåˆ¶å®šæ˜ç¢ºçš„è¨ˆåŠƒã€‚ç©©ç´®ç©©æ‰“æœƒå¸¶ä¾†æˆåŠŸã€‚' },
            { id: 5, name: 'æ•™çš‡', enName: 'The Hierophant', icon: 'â›ª', keywords: ['å‚³çµ±', 'æŒ‡å°', 'ä¿¡ä»°', 'æ•™è‚²'],
              meaning: 'æ•™çš‡ä»£è¡¨è‘—å‚³çµ±åƒ¹å€¼å’Œç²¾ç¥æŒ‡å°ã€‚ä»–æé†’æˆ‘å€‘å°Šé‡å‚³çµ±æ™ºæ…§ï¼ŒåŒæ™‚ä¹Ÿä»£è¡¨è‘—æ•™è‚²å’Œå­¸ç¿’ã€‚',
              advice: 'å‘æœ‰ç¶“é©—çš„äººè«‹æ•™ï¼Œéµå¾ªæ­£ç¢ºçš„æ–¹æ³•å’Œç¨‹åºã€‚å­¸ç¿’æ–°çŸ¥è­˜æœƒæœ‰æ”¶ç©«ã€‚' },
            { id: 6, name: 'æˆ€äºº', enName: 'The Lovers', icon: 'ğŸ’•', keywords: ['æ„›æƒ…', 'é¸æ“‡', 'å’Œè«§', 'åƒ¹å€¼è§€'],
              meaning: 'æˆ€äººç‰Œä»£è¡¨è‘—æ„›æƒ…å’Œé‡è¦çš„é¸æ“‡ã€‚å®ƒè±¡å¾µè‘—å…§å¿ƒåƒ¹å€¼è§€çš„çµ±ä¸€ï¼Œä»¥åŠèˆ‡ä»–äººå»ºç«‹æ·±å±¤é€£çµã€‚',
              advice: 'å‚¾è½ä½ çš„å¿ƒï¼Œåšå‡ºç¬¦åˆåƒ¹å€¼è§€çš„é¸æ“‡ã€‚æ„Ÿæƒ…æ–¹é¢æœƒæœ‰é‡è¦é€²å±•ã€‚' },
            { id: 7, name: 'æˆ°è»Š', enName: 'The Chariot', icon: 'ğŸï¸', keywords: ['å‹åˆ©', 'æ„å¿—', 'æ±ºå¿ƒ', 'æ§åˆ¶'],
              meaning: 'æˆ°è»Šä»£è¡¨è‘—å‹åˆ©å’Œå‰é€²çš„å‹•åŠ›ã€‚å®ƒè±¡å¾µè‘—å…‹æœéšœç¤™çš„æ±ºå¿ƒï¼Œä»¥åŠå°æ–¹å‘çš„æŒæ§ã€‚',
              advice: 'ä¿æŒå°ˆæ³¨å’Œæ±ºå¿ƒï¼Œç©æ¥µæ¡å–è¡Œå‹•ã€‚ä½ æ­£æœè‘—ç›®æ¨™ç©©æ­¥å‰é€²ã€‚' },
            { id: 8, name: 'åŠ›é‡', enName: 'Strength', icon: 'ğŸ¦', keywords: ['å‹‡æ°£', 'è€å¿ƒ', 'å…§åœ¨åŠ›é‡', 'æ…ˆæ‚²'],
              meaning: 'åŠ›é‡ç‰Œä»£è¡¨è‘—å…§åœ¨çš„å‹‡æ°£å’Œè€å¿ƒã€‚çœŸæ­£çš„åŠ›é‡ä¾†è‡ªæ–¼æº«æŸ”å’Œè‡ªæˆ‘æ§åˆ¶ï¼Œè€Œéè »åŠ›ã€‚',
              advice: 'ä»¥æŸ”å…‹å‰›ï¼Œç”¨è€å¿ƒå’Œæ„›å¿ƒé¢å°æŒ‘æˆ°ã€‚ç›¸ä¿¡è‡ªå·±çš„å…§åœ¨åŠ›é‡ã€‚' },
            { id: 9, name: 'éš±å£«', enName: 'The Hermit', icon: 'ğŸ”ï¸', keywords: ['å…§çœ', 'æ™ºæ…§', 'ç¨è™•', 'å°‹æ‰¾'],
              meaning: 'éš±å£«ä»£è¡¨è‘—å…§åœ¨çš„æ¢ç´¢å’Œæ™ºæ…§çš„è¿½å°‹ã€‚ä»–æé†’æˆ‘å€‘æœ‰æ™‚éœ€è¦ç¨è™•ä¾†æ‰¾åˆ°äººç”Ÿçš„ç­”æ¡ˆã€‚',
              advice: 'çµ¦è‡ªå·±ä¸€äº›ç¨è™•çš„æ™‚é–“ï¼Œåæ€å’Œæ²‰æ¾±ã€‚ç­”æ¡ˆæœƒåœ¨éœé»˜ä¸­æµ®ç¾ã€‚' },
            { id: 10, name: 'å‘½é‹ä¹‹è¼ª', enName: 'Wheel of Fortune', icon: 'ğŸ¡', keywords: ['è½‰è®Š', 'æ©Ÿæœƒ', 'å‘½é‹', 'é€±æœŸ'],
              meaning: 'å‘½é‹ä¹‹è¼ªä»£è¡¨è‘—ç”Ÿå‘½çš„å¾ªç’°å’Œè½‰è®Šã€‚å®ƒæé†’æˆ‘å€‘ä¸–äº‹ç„¡å¸¸ï¼Œå¥½é‹å’ŒæŒ‘æˆ°éƒ½æ˜¯æš«æ™‚çš„ã€‚',
              advice: 'æŠŠæ¡ç•¶ä¸‹çš„æ©Ÿæœƒï¼Œé †æ‡‰è®ŠåŒ–çš„æ½®æµã€‚å¥½é‹æ­£åœ¨é™è‡¨ï¼' },
            { id: 11, name: 'æ­£ç¾©', enName: 'Justice', icon: 'âš–ï¸', keywords: ['å…¬å¹³', 'çœŸç›¸', 'å› æœ', 'æ±ºæ–·'],
              meaning: 'æ­£ç¾©ç‰Œä»£è¡¨è‘—å…¬å¹³å’ŒçœŸç›¸ã€‚å®ƒæé†’æˆ‘å€‘æ¯å€‹è¡Œç‚ºéƒ½æœ‰å¾Œæœï¼Œè¦ç‚ºè‡ªå·±çš„é¸æ“‡è² è²¬ã€‚',
              advice: 'èª å¯¦é¢å°è‡ªå·±å’Œä»–äººï¼Œåšå‡ºå…¬æ­£çš„æ±ºå®šã€‚å› æœçµ‚å°‡é¡¯ç¾ã€‚' },
            { id: 12, name: 'å€’åŠäºº', enName: 'The Hanged Man', icon: 'ğŸ™ƒ', keywords: ['çŠ§ç‰²', 'ç­‰å¾…', 'æ–°è¦–è§’', 'æ”¾ä¸‹'],
              meaning: 'å€’åŠäººä»£è¡¨è‘—æš«åœå’Œæ›å€‹è§’åº¦çœ‹å•é¡Œã€‚æœ‰æ™‚å€™æ”¾æ‰‹å’Œç­‰å¾…æœƒå¸¶ä¾†æ„æƒ³ä¸åˆ°çš„æ”¶ç©«ã€‚',
              advice: 'å˜—è©¦ç”¨ä¸åŒçš„è§’åº¦çœ‹å¾…å•é¡Œï¼Œæœ‰æ™‚å€™ç­‰å¾…ä¹Ÿæ˜¯ä¸€ç¨®æ™ºæ…§ã€‚' },
            { id: 13, name: 'æ­»ç¥', enName: 'Death', icon: 'ğŸ¦‹', keywords: ['çµæŸ', 'è½‰è®Š', 'é‡ç”Ÿ', 'æ”¾ä¸‹éå»'],
              meaning: 'æ­»ç¥ç‰Œä»£è¡¨è‘—çµæŸå’Œè½‰è®Šã€‚å®ƒè±¡å¾µè‘—èˆŠäº‹ç‰©çš„çµ‚çµï¼Œç‚ºæ–°çš„é–‹å§‹æ¸…å‡ºç©ºé–“ã€‚',
              advice: 'æ”¾ä¸‹ä¸å†éœ€è¦çš„äº‹ç‰©ï¼Œæ“æŠ±æ”¹è®Šã€‚æ¯å€‹çµæŸéƒ½æ˜¯æ–°çš„é–‹å§‹ã€‚' },
            { id: 14, name: 'ç¯€åˆ¶', enName: 'Temperance', icon: 'ğŸº', keywords: ['å¹³è¡¡', 'èª¿å’Œ', 'è€å¿ƒ', 'é©åº¦'],
              meaning: 'ç¯€åˆ¶ä»£è¡¨è‘—å¹³è¡¡å’Œèª¿å’Œã€‚å®ƒæé†’æˆ‘å€‘åœ¨ç”Ÿæ´»ä¸­ä¿æŒä¸­åº¸ä¹‹é“ï¼Œé¿å…æ¥µç«¯ã€‚',
              advice: 'ä¿æŒå¹³è¡¡çš„ç”Ÿæ´»æ–¹å¼ï¼Œä¸è¦æ“ä¹‹éæ€¥ã€‚è€å¿ƒæœƒå¸¶ä¾†å¥½çµæœã€‚' },
            { id: 15, name: 'æƒ¡é­”', enName: 'The Devil', icon: 'ğŸ˜ˆ', keywords: ['æŸç¸›', 'èª˜æƒ‘', 'æ…¾æœ›', 'é™°å½±'],
              meaning: 'æƒ¡é­”ç‰Œä»£è¡¨è‘—å…§å¿ƒçš„æŸç¸›å’Œèª˜æƒ‘ã€‚å®ƒæé†’æˆ‘å€‘æ­£è¦–è‡ªå·±çš„é™°æš—é¢ï¼Œæ‰“ç ´è‡ªæˆ‘è¨­é™ã€‚',
              advice: 'æª¢è¦–ä»€éº¼åœ¨æŸç¸›ä½ ï¼Œæ˜¯æ™‚å€™æ‰“ç ´ä¸å¥åº·çš„æ¨¡å¼äº†ã€‚' },
            { id: 16, name: 'é«˜å¡”', enName: 'The Tower', icon: 'ğŸ—¼', keywords: ['çªè®Š', 'è¦ºé†’', 'è§£æ”¾', 'çœŸç›¸'],
              meaning: 'é«˜å¡”ä»£è¡¨è‘—çªç„¶çš„è®ŠåŒ–å’ŒèˆŠçµæ§‹çš„å´©å¡Œã€‚é›–ç„¶ä»¤äººä¸å®‰ï¼Œä½†å®ƒç‚ºé‡å»ºå¸¶ä¾†æ©Ÿæœƒã€‚',
              advice: 'æº–å‚™è¿æ¥è®ŠåŒ–ï¼Œæœ‰äº›äº‹æƒ…éœ€è¦è¢«æ‰“ç ´æ‰èƒ½é‡å»ºå¾—æ›´å¥½ã€‚' },
            { id: 17, name: 'æ˜Ÿæ˜Ÿ', enName: 'The Star', icon: 'â­', keywords: ['å¸Œæœ›', 'éˆæ„Ÿ', 'å¹³éœ', 'ä¿¡å¿ƒ'],
              meaning: 'æ˜Ÿæ˜Ÿä»£è¡¨è‘—å¸Œæœ›å’Œéˆæ„Ÿã€‚å®ƒè±¡å¾µè‘—å›°é›£éå¾Œçš„å¹³éœï¼Œä»¥åŠå°ç¾å¥½æœªä¾†çš„ä¿¡å¿ƒã€‚',
              advice: 'ä¿æŒå¸Œæœ›å’Œä¿¡å¿ƒï¼Œç¾å¥½çš„äº‹ç‰©æ­£åœ¨å‘ä½ é è¿‘ã€‚ç›¸ä¿¡å®‡å®™çš„å®‰æ’ã€‚' },
            { id: 18, name: 'æœˆäº®', enName: 'The Moon', icon: 'ğŸŒ•', keywords: ['å¹»è¦º', 'æ½›æ„è­˜', 'ææ‡¼', 'ç›´è¦º'],
              meaning: 'æœˆäº®ä»£è¡¨è‘—æ½›æ„è­˜å’Œç›´è¦ºã€‚å®ƒæé†’æˆ‘å€‘é—œæ³¨å¤¢å¢ƒå’Œå…§å¿ƒæ·±è™•çš„æ„Ÿå—ï¼Œä½†ä¹Ÿè¦å°å¿ƒå¹»è¦ºã€‚',
              advice: 'ä¿¡ä»»ä½ çš„ç›´è¦ºï¼Œä½†ä¹Ÿè¦åˆ†è¾¨å¹»è¦ºå’Œç¾å¯¦ã€‚ç­‰å¾…äº‹æƒ…è®Šå¾—æ¸…æ™°ã€‚' },
            { id: 19, name: 'å¤ªé™½', enName: 'The Sun', icon: 'â˜€ï¸', keywords: ['æˆåŠŸ', 'å–œæ‚…', 'æ´»åŠ›', 'å…‰æ˜'],
              meaning: 'å¤ªé™½æ˜¯æœ€æ­£é¢çš„ç‰Œä¹‹ä¸€ï¼Œä»£è¡¨è‘—æˆåŠŸã€å–œæ‚…å’Œå……æ²›çš„èƒ½é‡ã€‚ä¸€åˆ‡éƒ½æœƒè®Šå¾—å…‰æ˜ã€‚',
              advice: 'å……æ»¿è‡ªä¿¡åœ°å‰é€²ï¼ä»Šå¤©æ˜¯å……æ»¿èƒ½é‡å’Œæ­£å‘ç™¼å±•çš„ä¸€å¤©ã€‚' },
            { id: 20, name: 'å¯©åˆ¤', enName: 'Judgement', icon: 'ğŸ“¯', keywords: ['è¦ºé†’', 'æ›´æ–°', 'å¬å–š', 'åæ€'],
              meaning: 'å¯©åˆ¤ä»£è¡¨è‘—è¦ºé†’å’Œé‡ç”Ÿçš„å¬å–šã€‚å®ƒæé†’æˆ‘å€‘åæ€éå»ï¼Œæº–å‚™è¿æ¥æ–°çš„äººç”Ÿéšæ®µã€‚',
              advice: 'å‚¾è½å…§å¿ƒçš„å¬å–šï¼Œåšå‡ºé‡è¦çš„äººç”Ÿæ±ºå®šã€‚æ›´æ–°çš„æ™‚åˆ»åˆ°ä¾†äº†ã€‚' },
            { id: 21, name: 'ä¸–ç•Œ', enName: 'The World', icon: 'ğŸŒ', keywords: ['å®Œæˆ', 'åœ“æ»¿', 'æˆå°±', 'æ•´åˆ'],
              meaning: 'ä¸–ç•Œæ˜¯å¤§é˜¿çˆ¾å…‹é‚£çš„æœ€å¾Œä¸€å¼µç‰Œï¼Œä»£è¡¨è‘—ä¸€å€‹é€±æœŸçš„å®Œæˆå’Œåœ“æ»¿ã€‚ä½ å·²ç¶“é”æˆäº†ç›®æ¨™ã€‚',
              advice: 'æ…¶ç¥ä½ çš„æˆå°±ï¼ä¸€å€‹éšæ®µå·²ç¶“åœ“æ»¿å®Œæˆï¼Œæ–°çš„æ—…ç¨‹å³å°‡å±•é–‹ã€‚' }
        ];
        
        // ============================================
        // å…«å­—è³‡æ–™
        // ============================================
        const heavenlyStems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
        const earthlyBranches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        const stemElements = ['æœ¨', 'æœ¨', 'ç«', 'ç«', 'åœŸ', 'åœŸ', 'é‡‘', 'é‡‘', 'æ°´', 'æ°´'];
        const branchElements = ['æ°´', 'åœŸ', 'æœ¨', 'æœ¨', 'åœŸ', 'ç«', 'ç«', 'åœŸ', 'é‡‘', 'é‡‘', 'åœŸ', 'æ°´'];
        const branchHours = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
        
        const dayMasterTraits = {
            'ç”²': { element: 'æœ¨', trait: 'å¦‚å¤§æ¨¹èˆ¬æ­£ç›´å‘ä¸Šï¼Œæœ‰é ˜å°åŠ›å’Œå‰µé€ åŠ›ï¼Œä½†æœ‰æ™‚éæ–¼å›ºåŸ·ã€‚', lucky: 'æ°´ã€æœ¨', color: 'ç¶ è‰²ã€è—è‰²' },
            'ä¹™': { element: 'æœ¨', trait: 'å¦‚èŠ±è‰èˆ¬æŸ”è»Ÿéˆæ´»ï¼Œå–„æ–¼é©æ‡‰ç’°å¢ƒï¼Œæœ‰è—è¡“å¤©è³¦ï¼Œä½†æœ‰æ™‚å„ªæŸ”å¯¡æ–·ã€‚', lucky: 'æ°´ã€æœ¨', color: 'ç¶ è‰²ã€è—è‰²' },
            'ä¸™': { element: 'ç«', trait: 'å¦‚å¤ªé™½èˆ¬ç†±æƒ…é–‹æœ—ï¼Œæœ‰æ„ŸæŸ“åŠ›å’Œè¡Œå‹•åŠ›ï¼Œä½†æœ‰æ™‚éæ–¼è¡å‹•ã€‚', lucky: 'æœ¨ã€ç«', color: 'ç´…è‰²ã€æ©™è‰²' },
            'ä¸': { element: 'ç«', trait: 'å¦‚ç‡­ç«èˆ¬æº«æš–ç´°è†©ï¼Œæœ‰æ´å¯ŸåŠ›å’Œæ™ºæ…§ï¼Œä½†æœ‰æ™‚éæ–¼æ•æ„Ÿã€‚', lucky: 'æœ¨ã€ç«', color: 'ç´…è‰²ã€ç´«è‰²' },
            'æˆŠ': { element: 'åœŸ', trait: 'å¦‚é«˜å±±èˆ¬ç©©é‡å¯é ï¼Œæœ‰è²¬ä»»æ„Ÿå’ŒåŒ…å®¹å¿ƒï¼Œä½†æœ‰æ™‚éæ–¼ä¿å®ˆã€‚', lucky: 'ç«ã€åœŸ', color: 'é»ƒè‰²ã€æ£•è‰²' },
            'å·±': { element: 'åœŸ', trait: 'å¦‚ç”°åœ’èˆ¬æº«å’Œå‹™å¯¦ï¼Œæœ‰è€å¿ƒå’Œç´°å¿ƒï¼Œä½†æœ‰æ™‚éæ–¼è¬¹æ…ã€‚', lucky: 'ç«ã€åœŸ', color: 'é»ƒè‰²ã€ç±³è‰²' },
            'åºš': { element: 'é‡‘', trait: 'å¦‚å¯¶åŠèˆ¬æœæ–·å …æ¯…ï¼Œæœ‰æ±ºæ–·åŠ›å’ŒåŸ·è¡ŒåŠ›ï¼Œä½†æœ‰æ™‚éæ–¼å‰›ç¡¬ã€‚', lucky: 'åœŸã€é‡‘', color: 'ç™½è‰²ã€é‡‘è‰²' },
            'è¾›': { element: 'é‡‘', trait: 'å¦‚ç ç‰èˆ¬ç²¾ç·»å„ªé›…ï¼Œæœ‰å¯©ç¾åŠ›å’Œè¡¨é”åŠ›ï¼Œä½†æœ‰æ™‚éæ–¼æŒ‘å‰”ã€‚', lucky: 'åœŸã€é‡‘', color: 'ç™½è‰²ã€éŠ€è‰²' },
            'å£¬': { element: 'æ°´', trait: 'å¦‚å¤§æµ·èˆ¬åŒ…å®¹æ™ºæ…§ï¼Œæœ‰é è¦‹å’Œå‰µæ„ï¼Œä½†æœ‰æ™‚éæ–¼é£„å¿½ã€‚', lucky: 'é‡‘ã€æ°´', color: 'é»‘è‰²ã€è—è‰²' },
            'ç™¸': { element: 'æ°´', trait: 'å¦‚é›¨éœ²èˆ¬æ»‹æ½¤è¬ç‰©ï¼Œæœ‰ç›´è¦ºåŠ›å’Œé©æ‡‰åŠ›ï¼Œä½†æœ‰æ™‚éæ–¼å¤šæ…®ã€‚', lucky: 'é‡‘ã€æ°´', color: 'é»‘è‰²ã€æ·±è—è‰²' }
        };
        
        // ============================================
        // è¨­å®š
        // ============================================
        let settings = {
            gasUrl: ''
        };
        
        let currentTarotResult = null;
        let currentBaziResult = null;
        
        // ============================================
        // åˆå§‹åŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            updateStatusTime();
            setInterval(updateStatusTime, 1000);
            
            // é–‹æ©Ÿå‹•ç•«çµæŸå¾Œéš±è—
            setTimeout(() => {
                const splash = document.getElementById('splashScreen');
                splash.classList.add('fade-out');
                // å®Œå…¨ç§»é™¤
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 800);
            }, 2500); // 2.5 ç§’å¾Œé–‹å§‹æ·¡å‡º
        });
        
        function updateStatusTime() {
            const now = new Date();
            document.getElementById('statusTime').textContent = 
                `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('tarotBaziSettings');
            if (saved) {
                settings = JSON.parse(saved);
                document.getElementById('gasUrl').value = settings.gasUrl || '';
            }
        }
        
        function saveSettings() {
            settings.gasUrl = document.getElementById('gasUrl').value.trim();
            localStorage.setItem('tarotBaziSettings', JSON.stringify(settings));
        }
        
        function showSettings() {
            document.getElementById('settingsPanel').classList.add('active');
        }
        
        function hideSettings() {
            saveSettings();
            document.getElementById('settingsPanel').classList.remove('active');
            showToast('âœ… è¨­å®šå·²å„²å­˜');
        }
        
        function switchTab(tab) {
            // æ›´æ–° tab æ¨£å¼
            document.querySelectorAll('.feature-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            if (tab === 'tarot') {
                document.querySelector('.feature-tab:nth-child(1)').classList.add('active');
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
                document.getElementById('tarot-section').classList.add('active');
            } else {
                document.querySelector('.feature-tab:nth-child(2)').classList.add('active');
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
                document.getElementById('bazi-section').classList.add('active');
            }
        }
        
        function showHistory() {
            showToast('ğŸ“œ æ­·å²ç´€éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...');
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // ============================================
        // å¡”ç¾…å åœ
        // ============================================
        // å„²å­˜é¸ä¸­çš„ç‰Œ
        let selectedCards = [];
        let flippedCount = 0;
        let canFlip = false;
        
        function getFlipMode() {
            const mode = document.querySelector('input[name="flipMode"]:checked');
            return mode ? mode.value : 'auto';
        }
        
        function drawTarot() {
            const btn = document.querySelector('.draw-btn');
            const flipMode = getFlipMode();
            
            btn.disabled = true;
            btn.textContent = 'ğŸ”® æ´—ç‰Œä¸­...';
            
            // é‡ç½®ç‹€æ…‹
            flippedCount = 0;
            canFlip = false;
            selectedCards = [];
            
            // é‡ç½®å¡ç‰‡
            document.querySelectorAll('.tarot-card').forEach(card => {
                card.classList.remove('flipped');
                card.style.pointerEvents = 'none';
            });
            document.getElementById('tarotResult').classList.remove('show');
            document.getElementById('flipHint').style.display = 'none';
            
            // éš¨æ©Ÿé¸ç‰Œ
            const shuffled = [...tarotDeck].sort(() => Math.random() - 0.5);
            selectedCards = shuffled.slice(0, 3);
            
            // é å…ˆè¨­å®šç‰Œé¢ï¼ˆä½†ä¸ç¿»é–‹ï¼‰
            selectedCards.forEach((card, index) => {
                const cardEl = document.getElementById(`card${index + 1}`);
                const front = cardEl.querySelector('.card-front');
                front.querySelector('.card-image').textContent = card.icon;
                front.querySelector('.card-name').textContent = card.name;
            });
            
            // æ ¹æ“šæ¨¡å¼è™•ç†
            setTimeout(() => {
                if (flipMode === 'auto') {
                    // ğŸ¬ è‡ªå‹•ç¿»ç‰Œæ¨¡å¼
                    btn.textContent = 'ğŸ”® ç¿»ç‰Œä¸­...';
                    autoFlipCards();
                } else {
                    // ğŸ‘† æ‰‹å‹•ç¿»ç‰Œæ¨¡å¼
                    canFlip = true;
                    document.querySelectorAll('.tarot-card').forEach(card => {
                        card.style.pointerEvents = 'auto';
                    });
                    document.getElementById('flipHint').style.display = 'block';
                    btn.textContent = 'ğŸ‘† é»æ“Šå¡ç‰Œç¿»ç‰Œ';
                }
            }, 800);
        }
        
        // ğŸ¬ è‡ªå‹•ç¿»ç‰Œ
        function autoFlipCards() {
            selectedCards.forEach((card, index) => {
                setTimeout(() => {
                    const cardEl = document.getElementById(`card${index + 1}`);
                    cardEl.classList.add('flipped');
                    flippedCount++;
                    
                    // ä¸‰å¼µéƒ½ç¿»å®Œäº†
                    if (flippedCount === 3) {
                        setTimeout(() => {
                            showTarotResult(selectedCards[0]);
                            const btn = document.querySelector('.draw-btn');
                            btn.disabled = false;
                            btn.textContent = 'ğŸ”® é‡æ–°å åœ';
                        }, 500);
                    }
                }, index * 600);
            });
        }
        
        // ğŸ‘† æ‰‹å‹•ç¿»ç‰Œ
        function flipCard(cardNum) {
            if (!canFlip) return;
            
            const cardEl = document.getElementById(`card${cardNum}`);
            
            // å·²ç¶“ç¿»éäº†
            if (cardEl.classList.contains('flipped')) return;
            
            // ç¿»ç‰Œ
            cardEl.classList.add('flipped');
            flippedCount++;
            
            // ä¸‰å¼µéƒ½ç¿»å®Œäº†
            if (flippedCount === 3) {
                canFlip = false;
                document.getElementById('flipHint').style.display = 'none';
                
                setTimeout(() => {
                    showTarotResult(selectedCards[0]);
                    
                    const btn = document.querySelector('.draw-btn');
                    btn.disabled = false;
                    btn.textContent = 'ğŸ”® é‡æ–°å åœ';
                }, 500);
            }
        }
        
        function showTarotResult(card) {
            // éš¨æ©Ÿé‹å‹¢åˆ†æ•¸
            const overall = Math.floor(Math.random() * 30) + 70;
            const love = Math.floor(Math.random() * 40) + 50;
            const career = Math.floor(Math.random() * 40) + 55;
            const wealth = Math.floor(Math.random() * 40) + 45;
            
            // æ›´æ–° UI
            document.getElementById('resultCardImage').innerHTML = `
                <span>${card.icon}</span>
                <span class="name">${card.name}</span>
            `;
            document.getElementById('resultCardName').textContent = card.name;
            document.getElementById('resultCardEnName').textContent = card.enName;
            document.getElementById('resultKeywords').innerHTML = 
                card.keywords.map(k => `<span class="keyword">${k}</span>`).join('');
            
            document.getElementById('overallScore').textContent = overall;
            document.getElementById('overallScore').className = `score ${overall >= 75 ? 'high' : overall >= 50 ? 'mid' : 'low'}`;
            
            document.getElementById('loveScore').textContent = love;
            document.getElementById('loveScore').className = `score ${love >= 75 ? 'high' : love >= 50 ? 'mid' : 'low'}`;
            
            document.getElementById('careerScore').textContent = career;
            document.getElementById('careerScore').className = `score ${career >= 75 ? 'high' : career >= 50 ? 'mid' : 'low'}`;
            
            document.getElementById('wealthScore').textContent = wealth;
            document.getElementById('wealthScore').className = `score ${wealth >= 75 ? 'high' : wealth >= 50 ? 'mid' : 'low'}`;
            
            document.getElementById('resultMeaning').textContent = card.meaning;
            document.getElementById('resultAdvice').textContent = card.advice;
            
            document.getElementById('tarotResult').classList.add('show');
            
            // å„²å­˜çµæœ
            currentTarotResult = {
                card: card,
                scores: { overall, love, career, wealth },
                date: new Date().toLocaleDateString('zh-TW')
            };
        }
        
        // ============================================
        // å…«å­—å‘½ç›¤
        // ============================================
        function analyzeBazi() {
            const year = parseInt(document.getElementById('birthYear').value);
            const month = parseInt(document.getElementById('birthMonth').value);
            const day = parseInt(document.getElementById('birthDay').value);
            const hour = parseInt(document.getElementById('birthHour').value);
            const gender = document.getElementById('gender').value;
            
            if (!year || !month || !day || isNaN(hour)) {
                showToast('âš ï¸ è«‹å¡«å¯«å®Œæ•´çš„å‡ºç”Ÿè³‡è¨Š');
                return;
            }
            
            // è¨ˆç®—å…«å­—ï¼ˆç°¡åŒ–ç®—æ³•ï¼‰
            const bazi = calculateBazi(year, month, day, hour);
            
            // é¡¯ç¤ºçµæœ
            displayBaziResult(bazi, gender);
        }
        
        function calculateBazi(year, month, day, hour) {
            // å¹´æŸ±ï¼ˆç°¡åŒ–ï¼šç”¨å¹´ä»½ç›´æ¥è¨ˆç®—ï¼‰
            const yearStemIdx = (year - 4) % 10;
            const yearBranchIdx = (year - 4) % 12;
            
            // æœˆæŸ±ï¼ˆç°¡åŒ–ç®—æ³•ï¼‰
            const monthStemIdx = (yearStemIdx * 2 + month) % 10;
            const monthBranchIdx = (month + 1) % 12;
            
            // æ—¥æŸ±ï¼ˆç°¡åŒ–ï¼šä½¿ç”¨å½éš¨æ©Ÿä½†å›ºå®šçš„ç®—æ³•ï¼‰
            const daySeed = year * 365 + month * 30 + day;
            const dayStemIdx = daySeed % 10;
            const dayBranchIdx = daySeed % 12;
            
            // æ™‚æŸ±
            const hourStemIdx = (dayStemIdx * 2 + hour) % 10;
            const hourBranchIdx = hour;
            
            return {
                year: { stem: heavenlyStems[yearStemIdx], branch: earthlyBranches[yearBranchIdx], 
                        stemElement: stemElements[yearStemIdx], branchElement: branchElements[yearBranchIdx] },
                month: { stem: heavenlyStems[monthStemIdx], branch: earthlyBranches[monthBranchIdx],
                         stemElement: stemElements[monthStemIdx], branchElement: branchElements[monthBranchIdx] },
                day: { stem: heavenlyStems[dayStemIdx], branch: earthlyBranches[dayBranchIdx],
                       stemElement: stemElements[dayStemIdx], branchElement: branchElements[dayBranchIdx] },
                hour: { stem: heavenlyStems[hourStemIdx], branch: earthlyBranches[hourBranchIdx],
                        stemElement: stemElements[hourStemIdx], branchElement: branchElements[hourBranchIdx] }
            };
        }
        
        function displayBaziResult(bazi, gender) {
            // æ›´æ–°å››æŸ±
            document.getElementById('yearHeaven').textContent = bazi.year.stem;
            document.getElementById('yearEarth').textContent = bazi.year.branch;
            document.getElementById('yearElement').textContent = `${bazi.year.stemElement}/${bazi.year.branchElement}`;
            
            document.getElementById('monthHeaven').textContent = bazi.month.stem;
            document.getElementById('monthEarth').textContent = bazi.month.branch;
            document.getElementById('monthElement').textContent = `${bazi.month.stemElement}/${bazi.month.branchElement}`;
            
            document.getElementById('dayHeaven').textContent = bazi.day.stem;
            document.getElementById('dayEarth').textContent = bazi.day.branch;
            document.getElementById('dayElement').textContent = `${bazi.day.stemElement}/${bazi.day.branchElement}`;
            
            document.getElementById('hourHeaven').textContent = bazi.hour.stem;
            document.getElementById('hourEarth').textContent = bazi.hour.branch;
            document.getElementById('hourElement').textContent = `${bazi.hour.stemElement}/${bazi.hour.branchElement}`;
            
            // è¨ˆç®—äº”è¡Œçµ±è¨ˆ
            const elements = { 'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0 };
            [bazi.year, bazi.month, bazi.day, bazi.hour].forEach(pillar => {
                elements[pillar.stemElement]++;
                elements[pillar.branchElement]++;
            });
            
            const total = Object.values(elements).reduce((a, b) => a + b, 0);
            
            // æ›´æ–°äº”è¡Œåœ–è¡¨
            document.getElementById('woodBar').style.width = `${(elements['æœ¨'] / total) * 100}%`;
            document.getElementById('woodCount').textContent = elements['æœ¨'];
            
            document.getElementById('fireBar').style.width = `${(elements['ç«'] / total) * 100}%`;
            document.getElementById('fireCount').textContent = elements['ç«'];
            
            document.getElementById('earthBar').style.width = `${(elements['åœŸ'] / total) * 100}%`;
            document.getElementById('earthCount').textContent = elements['åœŸ'];
            
            document.getElementById('metalBar').style.width = `${(elements['é‡‘'] / total) * 100}%`;
            document.getElementById('metalCount').textContent = elements['é‡‘'];
            
            document.getElementById('waterBar').style.width = `${(elements['æ°´'] / total) * 100}%`;
            document.getElementById('waterCount').textContent = elements['æ°´'];
            
            // æ—¥ä¸»åˆ†æ
            const dayMaster = bazi.day.stem;
            const traits = dayMasterTraits[dayMaster];
            
            document.getElementById('dayMasterAnalysis').textContent = 
                `æ‚¨çš„æ—¥ä¸»ç‚ºã€Œ${dayMaster}ã€ï¼Œå±¬${traits.element}ã€‚${traits.trait}`;
            
            // å‘½æ ¼åˆ†æï¼ˆç°¡åŒ–ï¼‰
            const missingElements = Object.entries(elements)
                .filter(([_, count]) => count === 0)
                .map(([element]) => element);
            
            let destinyText = `å…«å­—äº”è¡Œä¸­ï¼Œ`;
            if (missingElements.length > 0) {
                destinyText += `ç¼ºå°‘${missingElements.join('ã€')}ï¼Œå»ºè­°åœ¨ç”Ÿæ´»ä¸­å¤šè£œå……ç›¸é—œå…ƒç´ ã€‚`;
            } else {
                destinyText += `äº”è¡Œä¿±å…¨ï¼Œå‘½æ ¼è¼ƒç‚ºå¹³è¡¡ã€‚`;
            }
            
            const maxElement = Object.entries(elements).reduce((a, b) => a[1] > b[1] ? a : b)[0];
            destinyText += `å‘½ä¸­${maxElement}æ—ºï¼Œ${getElementTrait(maxElement)}`;
            
            document.getElementById('destinyAnalysis').textContent = destinyText;
            
            // é–‹é‹å»ºè­°
            document.getElementById('luckyAdvice').textContent = 
                `é–‹é‹é¡è‰²ï¼š${traits.color}ã€‚æœ‰åˆ©äº”è¡Œï¼š${traits.lucky}ã€‚å»ºè­°å¤šå¾€æœ‰åˆ©æ–¹ä½ç™¼å±•ï¼Œä½©æˆ´ç›¸æ‡‰é¡è‰²çš„é£¾å“å¯å¢å¼·é‹å‹¢ã€‚`;
            
            document.getElementById('baziResult').classList.add('show');
            
            // å„²å­˜çµæœ
            currentBaziResult = {
                bazi: bazi,
                elements: elements,
                dayMaster: dayMaster,
                traits: traits,
                gender: gender
            };
        }
        
        function getElementTrait(element) {
            const traits = {
                'æœ¨': 'ä»£è¡¨ä»æ…ˆã€æˆé•·ã€å‰µæ–°çš„ç‰¹è³ªè¼ƒç‚ºçªå‡ºã€‚',
                'ç«': 'ä»£è¡¨ç†±æƒ…ã€ç¦®å„€ã€è¡Œå‹•çš„ç‰¹è³ªè¼ƒç‚ºçªå‡ºã€‚',
                'åœŸ': 'ä»£è¡¨èª ä¿¡ã€ç©©é‡ã€åŒ…å®¹çš„ç‰¹è³ªè¼ƒç‚ºçªå‡ºã€‚',
                'é‡‘': 'ä»£è¡¨ç¾©æ°£ã€æœæ–·ã€å …æ¯…çš„ç‰¹è³ªè¼ƒç‚ºçªå‡ºã€‚',
                'æ°´': 'ä»£è¡¨æ™ºæ…§ã€éˆæ´»ã€é©æ‡‰çš„ç‰¹è³ªè¼ƒç‚ºçªå‡ºã€‚'
            };
            return traits[element];
        }
        
        // ============================================
        // LINE ç™¼é€
        // ============================================
        async function sendTarotToLine() {
            if (!settings.gasUrl) {
                showToast('âš ï¸ è«‹å…ˆè¨­å®š GAS URL');
                showSettings();
                return;
            }
            
            if (!currentTarotResult) {
                showToast('âš ï¸ è«‹å…ˆé€²è¡Œå åœ');
                return;
            }
            
            const btn = document.querySelector('#tarot-section .line-send-btn');
            btn.disabled = true;
            btn.innerHTML = 'â³ ç™¼é€ä¸­...';
            
            try {
                const data = {
                    action: 'sendTarot',
                    result: currentTarotResult
                };
                
                await fetch(settings.gasUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showToast('âœ… å·²ç™¼é€åˆ° LINEï¼');
            } catch (error) {
                showToast('âŒ ç™¼é€å¤±æ•—');
                console.error(error);
            }
            
            btn.disabled = false;
            btn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 2C6.48 2 2 5.82 2 10.5c0 2.55 1.25 4.83 3.24 6.36-.12.97-.63 3.61-.73 4.19 0 0-.02.17.09.24.1.06.24.02.24.02.32-.04 3.78-2.47 4.36-2.89.93.14 1.87.21 2.8.21 5.52 0 10-3.82 10-8.5S17.52 2 12 2z"/>
                </svg>
                ç™¼é€åˆ° LINE
            `;
        }
        
        async function sendBaziToLine() {
            if (!settings.gasUrl) {
                showToast('âš ï¸ è«‹å…ˆè¨­å®š GAS URL');
                showSettings();
                return;
            }
            
            if (!currentBaziResult) {
                showToast('âš ï¸ è«‹å…ˆåˆ†æå‘½ç›¤');
                return;
            }
            
            const btn = document.querySelector('#bazi-section .line-send-btn');
            btn.disabled = true;
            btn.innerHTML = 'â³ ç™¼é€ä¸­...';
            
            try {
                const data = {
                    action: 'sendBazi',
                    result: currentBaziResult
                };
                
                await fetch(settings.gasUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                showToast('âœ… å·²ç™¼é€åˆ° LINEï¼');
            } catch (error) {
                showToast('âŒ ç™¼é€å¤±æ•—');
                console.error(error);
            }
            
            btn.disabled = false;
            btn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 2C6.48 2 2 5.82 2 10.5c0 2.55 1.25 4.83 3.24 6.36-.12.97-.63 3.61-.73 4.19 0 0-.02.17.09.24.1.06.24.02.24.02.32-.04 3.78-2.47 4.36-2.89.93.14 1.87.21 2.8.21 5.52 0 10-3.82 10-8.5S17.52 2 12 2z"/>
                </svg>
                ç™¼é€åˆ° LINE
            `;
        }
    </script>
</body>
</html>
